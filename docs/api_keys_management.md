# 密钥管理功能

## 功能概述

密钥管理模块提供了完整的API密钥管理功能，包括：

1. **密钥列表** (`api_keys_page.dart`)
   - 显示所有已添加的密钥
   - Key字段默认隐藏显示为 ••••••••
   - 支持从YAML文件导入密钥
   - 支持创建新密钥
   - 支持删除密钥
   - 点击密钥卡片进入详情页

2. **密钥详情** (`api_key_detail_page.dart`)
   - 显示密钥的完整信息（BID、Key、Model等）
   - Key字段支持显示/隐藏切换（点击眼睛图标）
   - 支持复制各个字段到剪贴板
   - 底部显眼位置提供导出按钮
   - 导出时可选择保存目录

## 使用流程

### 添加密钥

点击右上角的 + 按钮，会出现两个选项：

#### 1. 导入密钥
1. 选择"导入"选项
2. 选择一个 `.yaml` 或 `.yml` 格式的密钥文件
3. 系统会自动验证并导入密钥

#### 2. 创建密钥
1. 选择"创建"选项
2. 在对话框中输入：
   - Name: 密钥名称（必填）
   - Intro: 密钥描述（可选）
3. 系统会自动生成：
   - BID: 32位16进制随机字符串
   - Key: 64位16进制随机字符串（等同于Python的`os.urandom(32).hex()`）
   - Model: 固定值 `e9b837c9afa0d5d25f78eae3a76a665d`
4. 点击"创建"完成

### 查看密钥详情
1. 在密钥列表中点击任意密钥卡片
2. 进入详情页查看完整信息
3. 点击Key字段右侧的眼睛图标可切换显示/隐藏
4. 点击复制按钮可复制各个字段

### 导出密钥
1. 在密钥详情页底部点击"导出密钥"按钮
2. 系统会打开文件保存对话框
3. 选择保存位置和文件名
4. 密钥会被导出为YAML文件

### 删除密钥
1. 在密钥列表中点击密钥卡片右侧的删除按钮
2. 确认删除操作

## 安全特性

- **列表页隐藏**: Key字段在列表中默认显示为 ••••••••，保护敏感信息
- **详情页可控**: 详情页中Key字段默认隐藏，需要点击眼睛图标才能查看
- **复制功能**: 提供快速复制功能，无需手动选择
- **本地存储**: 密钥使用SharedPreferences加密存储在本地
- **安全随机**: 使用`Random.secure()`生成密码学安全的随机数

## 密钥文件格式

```yaml
bid: 32位16进制字符串
key: 64位16进制字符串 (等同于 os.urandom(32).hex())
name: 密钥名称
intro: 密钥描述
model: e9b837c9afa0d5d25f78eae3a76a665d (固定值)
```

## 技术实现

- 使用 `SharedPreferences` 进行本地持久化存储
- 使用 `file_picker` 选择导入文件和保存位置
- 使用 `FilePicker.platform.saveFile` 让用户选择导出目录
- 使用 `yaml` 包解析和生成YAML文件
- 使用 `Clipboard` API 实现复制功能
- 使用 `Random.secure()` 生成密码学安全的随机数
- Key字段使用 `•` 字符隐藏显示，字符间距加大以模拟密钥长度
- BID生成: 16字节随机数据 = 32个十六进制字符
- Key生成: 32字节随机数据 = 64个十六进制字符（与Python `os.urandom(32).hex()` 等效）
